<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <script type="application/javascript">
        var world_width = 1540;
        var world_height = 600;
        var g = 0.05;
        var x = 1;
        var y = 1;
        var r = 25;
        var d = 1;
        var dx = d;
        var dy = d;
        var n = 10;

        function Ball(x, y) {
            this.x = x;
            this.y = y;
            this.dx = d;
            this.dy = d;
            this.r = r;
        }

        var balls = [];

        function start() {
            init();
            run();
        }

        function init() {
            var canvas = document.getElementById("canvas");
            if (canvas.getContext) {
                var ctx = canvas.getContext("2d");
                canvas.width = world_width;
                canvas.height = world_height;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
            for (var i = 0; i < n; i++) {
                balls[i] = new Ball(Math.random() * canvas.width, Math.random() * canvas.height);
            }
        }

        function run() {
            draw();
            doPhysics();
            setTimeout(run, 0);
        }

        function draw() {
            var canvas = document.getElementById("canvas");
            if (canvas.getContext) {
                var ctx = canvas.getContext("2d");
//                canvas.width = world_width;
//                canvas.height = world_height;
                ctx.clearRect(0,0, ctx.width, ctx.height);
                for (var i = 0; i < balls.length; i++) {
                    b = balls[i];
                    ctx.beginPath();
                    ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
                    ctx.stroke();
                    ctx.closePath();
                }
            }
        }

        function doPhysics() {
            for (var i = 0; i < balls.length; i++) {
                b = balls[i];

                b.dy += g;
                b.x += b.dx;
                b.y += b.dy;
                if (b.x + b.r > world_width) {
                    b.x = world_width - b.r - b.dx;
                    b.dx = -b.dx;
                }
                if (b.x - b.r < 0) {
                    b.x = b.r + b.dx;
                    b.dx = -b.dx;
                }
                if (b.y + b.r > world_height) {
                    b.y = world_height - b.r - b.dy;
                    b.dy = -b.dy;
                    b.dy *= 0.9;
                }
                if (b.y - b.r < 0) {
                    b.y = b.r + b.dy;
                    b.dy = -b.dy;
                    b.dy *= 0.9;
                }
            }
        }
    </script>
</head>

<body onload="start();">
    <canvas id="canvas" width="150" height="150"></canvas>
</body>

</html>
